"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NormalizeRegistry = exports.GetRegistries = void 0;
const fs = require("fs");
const ini = require("ini");
const tl = require("azure-pipelines-task-lib/task");
function GetRegistries(npmrc, saveNormalizedRegistries) {
    let registries = [];
    let config = ini.parse(fs.readFileSync(npmrc).toString());
    for (let key in config) {
        let colonIndex = key.indexOf(':');
        if (key.substring(colonIndex + 1).toLowerCase() === 'registry') {
            config[key] = NormalizeRegistry(config[key]);
            registries.push(config[key]);
        }
    }
    if (saveNormalizedRegistries) {
        // save the .npmrc with normalized registries
        tl.writeFile(npmrc, ini.stringify(config));
    }
    return registries;
}
exports.GetRegistries = GetRegistries;
function NormalizeRegistry(registry) {
    if (registry && !registry.endsWith('/')) {
        registry += '/';
    }
    return registry;
}
exports.NormalizeRegistry = NormalizeRegistry;
